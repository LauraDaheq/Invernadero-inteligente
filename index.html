<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Invernadero Inteligente</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      margin: 0;
      padding: 0;
      background-color: #d8f6d6;
    }
    header {
      background-color: #5cc472;
      padding: 1rem;
      text-align: center;
      color: white;
      font-size: 1.5rem;
    }
    main {
      padding: 1rem;
    }
    .card {
      background-color: white;
      padding: 1rem;
      margin: 0.5rem;
      border-radius: 10px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      text-align: center;
    }
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 1rem;
    }
    button {
      background-color: #2e8b57;
      color: white;
      border: none;
      border-radius: 25px;
      padding: 0.75rem 1.5rem;
      font-size: 1rem;
      cursor: pointer;
      margin: 0.5rem auto;
      display: block;
    }
    .bottom-nav {
      position: fixed;
      bottom: 0;
      width: 100%;
      background-color: white;
      display: flex;
      justify-content: space-around;
      padding: 0.5rem 0;
      border-top: 1px solid #ccc;
    }
    .bottom-nav div {
      text-align: center;
      font-size: 0.9rem;
      cursor: pointer;
    }
    section {
      display: none;
    }
    section.active {
      display: block;
    }
  </style>
</head>
<body>

  <header>ğŸŒ¿ Invernadero Inteligente</header>

  <main>
    <section id="inicio" class="active">
      <h2>ğŸ“˜ Proyecto</h2>
      <p>
        Este proyecto nace como respuesta a la dificultad de mantener condiciones 
        Ã³ptimas para la germinaciÃ³n y crecimiento de plantas aromÃ¡ticas en interiores.
      </p>
      <p>
        Se trata de un <strong>invernadero automatizado</strong> con sensores, actuadores 
        y una <strong>aplicaciÃ³n web</strong> que permite monitorear y controlar las variables ambientales en tiempo real.
      </p>
    </section>

    <section id="dashboard">
      <h2>ğŸ  Panel de Control</h2>
      <p>Visualiza las variables ambientales en tiempo real.</p>
      <div class="grid">
        <div class="card">
          <h3>ğŸŒ¡ï¸ <span id="temp">-</span> Â°C</h3>
          <p>Temperatura ambiente</p>
        </div>
        <div class="card">
          <h3>ğŸ’§ <span id="humAir">-</span> %</h3>
          <p>Humedad del aire</p>
        </div>
        <div class="card">
          <h3>ğŸŒ± <span id="humSoil">-</span> %</h3>
          <p>Humedad del suelo</p>
        </div>
        <div class="card">
          <h3>ğŸš¿ <span id="waterLvl">-</span> %</h3>
          <p>Nivel del tanque</p>
        </div>
      </div>
      <div id="alertas" style="margin-top: 1rem; color: red; font-weight: bold;"></div>
    </section>

<section id="temperatura">
  <h2>ğŸŒ¡ï¸ Temperatura</h2>
  <p>GrÃ¡fico de temperatura ambiente en tiempo real.</p>
  <iframe 
    width="100%" 
    height="300" 
    style="border:none" 
    src="https://thingspeak.mathworks.com/channels/2993017/charts/1?bgcolor=%23d8f6d6&color=%235cc472&dynamic=true&type=line&title=Temperatura+(Â°C)">
  </iframe>
</section>

	
<section id="humedad-aire">
  <h2>ğŸ’§ Humedad del Aire</h2>
  <p>GrÃ¡fico de humedad relativa del aire.</p>
  <iframe 
    width="100%" 
    height="300" 
    style="border:none" 
    src="https://thingspeak.mathworks.com/channels/2993017/charts/2?bgcolor=%23d8f6d6&color=%230094c4&dynamic=true&type=line&title=Humedad+del+Aire+(%25)">
  </iframe>
</section>

<section id="humedad-suelo">
  <h2>ğŸŒ± Humedad del Suelo</h2>
  <p>GrÃ¡fico de humedad del suelo.</p>
  <iframe 
    width="100%" 
    height="300" 
    style="border:none" 
    src="https://thingspeak.mathworks.com/channels/2993017/charts/3?bgcolor=%23d8f6d6&color=%23c47300&dynamic=true&type=line&title=Humedad+del+Suelo+(%25)">
  </iframe>
</section>

<section id="nivel-tanque">
  <h2>ğŸš¿ Nivel del Tanque</h2>
  <p>GrÃ¡fico del nivel de agua en el tanque.</p>
  <iframe 
    width="100%" 
    height="300" 
    style="border:none" 
    src="https://thingspeak.mathworks.com/channels/2993017/charts/4?bgcolor=%23d8f6d6&color=%23008B8B&dynamic=true&type=line&title=Nivel+del+Tanque+(%25)">
  </iframe>
</section>


    <section id="riego">
      <h2>ğŸ’¦ Control de Riego</h2>
      <button onclick="activarRiego()">Activar Riego</button>
      <button onclick="apagarRiego()">Apagar Riego</button>
      <p id="riegoStatus"></p>
    </section>

    <section id="luces">
      <h2>ğŸ’¡ Control de Luces</h2>
      <button onclick="encenderLuces()">Encender Luces</button>
      <button onclick="apagarLuces()">Apagar Luces</button>
      <p id="luzStatus"></p>
    </section>
  </main>

  <nav class="bottom-nav">
    <div onclick="mostrarSeccion('inicio')">ğŸ“˜<br>Inicio</div>
    <div onclick="mostrarSeccion('dashboard')">ğŸ <br>Panel</div>
    <div onclick="mostrarSeccion('temperatura')">ğŸŒ¡ï¸<br>Temp</div>
    <div onclick="mostrarSeccion('humedad-aire')">ğŸ’§<br>Aire</div>
    <div onclick="mostrarSeccion('humedad-suelo')">ğŸŒ±<br>Suelo</div>
    <div onclick="mostrarSeccion('nivel-tanque')">ğŸš¿<br>Tanque</div>
    <div onclick="mostrarSeccion('riego')">ğŸ’¦<br>Riego</div>
    <div onclick="mostrarSeccion('luces')">ğŸ’¡<br>Luces</div>
  </nav>

  <audio id="alertaAudio" src="alerta.mp3" preload="auto"></audio>

  <script>
  const apiKeyEscritura = "MQ7YSC1YB1ZEDEOW";
  const apiKeyLectura = "IFDLL1D2OQV7OZCD";
  const canal = "2993017";
  let historial = [];

  function mostrarSeccion(id) {
    document.querySelectorAll("section").forEach(sec => sec.classList.remove("active"));
    document.getElementById(id).classList.add("active");
  }

  function actualizarDatos() {
    const readAPI = `https://api.thingspeak.com/channels/${canal}/feeds/last.json?api_key=${apiKeyLectura}`;
    fetch(readAPI)
      .then(res => res.json())
      .then(data => {
        const temp = parseFloat(data.field1);
        const humAir = data.field2;
        const humSoil = data.field3;
        const waterLvl = parseFloat(data.field4);
        const riego = data.field5;
        const luces = data.field6;

        document.getElementById("temp").textContent = temp.toFixed(2);
        document.getElementById("humAir").textContent = humAir;
        document.getElementById("humSoil").textContent = humSoil;
        document.getElementById("waterLvl").textContent = waterLvl;

        document.getElementById("riegoStatus").textContent = riego == 1 ? "âœ”ï¸ Riego Activado" : "ğŸ’§ Riego Apagado";
        document.getElementById("luzStatus").textContent = luces == 1 ? "ğŸ’¡ Luces Encendidas" : "ğŸ”Œ Luces Apagadas";

        let hayAlerta = false;
        if (waterLvl < 20) {
          hayAlerta = true;
          mostrarNotificacion("Nivel de agua bajo", "El tanque tiene menos del 20â€¯% de agua.");
          document.getElementById("waterLvl").style.color = "red";
        } else {
          document.getElementById("waterLvl").style.color = "black";
        }

        if (temp > 28) {
          hayAlerta = true;
          mostrarNotificacion("Temperatura alta", "El ambiente supera los 28â€¯Â°C.");
          document.getElementById("temp").style.color = "red";
        } else {
          document.getElementById("temp").style.color = "black";
        }

        if (!hayAlerta) {
          document.getElementById("alertas").textContent = "âœ… Condiciones normales.";
        }
      })
      .catch(err => {
        console.error("Error al obtener datos:", err);
        document.getElementById("alertas").textContent = "âŒ Error al cargar datos";
      });
  }

  function mostrarNotificacion(titulo, mensaje) {
    if (Notification.permission === "granted") {
      new Notification(titulo, { body: mensaje });
      document.getElementById("alertaAudio").play();
    }
    const entrada = `${new Date().toLocaleTimeString()} - ${titulo}: ${mensaje}`;
    historial.push(entrada);
    mostrarHistorial();
  }

  function mostrarHistorial() {
    const alertasHTML = historial.slice(-5).map(a => `ğŸ”” ${a}`).join("<br>");
    document.getElementById("alertas").innerHTML = alertasHTML;
  }

  function activarRiego() {
    fetch(`https://api.thingspeak.com/update?api_key=${apiKeyEscritura}&field5=1`)
      .then(() => {
        document.getElementById("riegoStatus").textContent = "âœ”ï¸ Activando riego...";
        setTimeout(actualizarDatos, 16000);
      });
  }

  function apagarRiego() {
    fetch(`https://api.thingspeak.com/update?api_key=${apiKeyEscritura}&field5=0`)
      .then(() => {
        document.getElementById("riegoStatus").textContent = "â³ Apagando riego...";
        setTimeout(actualizarDatos, 16000);
      });
  }

  function encenderLuces() {
    fetch(`https://api.thingspeak.com/update?api_key=${apiKeyEscritura}&field6=1`)
      .then(() => {
        document.getElementById("luzStatus").textContent = "ğŸ’¡ Encendiendo luces...";
        setTimeout(actualizarDatos, 16000);
      });
  }

  function apagarLuces() {
    fetch(`https://api.thingspeak.com/update?api_key=${apiKeyEscritura}&field6=0`)
      .then(() => {
        document.getElementById("luzStatus").textContent = "ğŸ”Œ Apagando luces...";
        setTimeout(actualizarDatos, 16000);
      });
  }

  if (Notification.permission !== "granted") {
    Notification.requestPermission();
  }

  actualizarDatos();
  setInterval(actualizarDatos, 15000);
</script>

</body>
</html>
